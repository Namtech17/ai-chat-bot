<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat Assistant</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
            transition: background-color 0.3s;
        }
        #chat-container {
            width: 400px;
            height: 600px;
            border: 1px solid #ccc;
            border-radius: 5px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            background-color: white;
            transition: background-color 0.3s;
        }
        .header {
            background-color: #007bff;
            color: white;
            padding: 10px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }
        .messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
        }
        .message {
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 5px;
            max-width: 70%;
        }
        .user {
            background-color: #007bff;
            color: white;
            align-self: flex-end;
            margin-left: auto;
        }
        .assistant {
            background-color: #f1f0f0;
            color: black;
            align-self: flex-start;
        }
        .input-group {
            display: flex;
            padding: 10px;
        }
        #user-input {
            flex-grow: 1;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        #send-button {
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 3px;
            margin-left: 5px;
            cursor: pointer;
        }
        .footer {
            background-color: #f8f9fa;
            padding: 10px;
            text-align: center;
            font-size: 12px;
        }
        .dark-mode {
            background-color: #333;
            color: white;
        }
        .dark-mode #chat-container {
            background-color: #444;
            color: white;
        }
        .dark-mode .assistant {
            background-color: #555;
            color: white;
        }
        .dark-mode .footer {
            background-color: #222;
            color: white;
        }
        #mode-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="chat-container"></div>
    <button id="mode-toggle">Toggle Dark Mode</button>

    <script type="text/babel">
        function ChatApp() {
            const [messages, setMessages] = React.useState([]);
            const [userInput, setUserInput] = React.useState('');
            const [darkMode, setDarkMode] = React.useState(false);
            const messagesEndRef = React.useRef(null);

            React.useEffect(() => {
                scrollToBottom();
            }, [messages]);

            React.useEffect(() => {
                const modeToggle = document.getElementById('mode-toggle');
                modeToggle.addEventListener('click', toggleDarkMode);
                return () => modeToggle.removeEventListener('click', toggleDarkMode);
            }, []);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            const toggleDarkMode = () => {
                setDarkMode(!darkMode);
                document.body.classList.toggle('dark-mode');
            };

            const sendMessage = async () => {
                if (userInput.trim() === '') return;

                const newMessages = [...messages, { text: userInput, sender: 'user' }];
                setMessages(newMessages);
                setUserInput('');

                try {
                    const response = await fetch('/api/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ message: userInput }),
                    });

                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }

                    const data = await response.json();
                    setMessages([...newMessages, { text: data.response, sender: 'assistant' }]);
                } catch (error) {
                    console.error('Error:', error);
                    setMessages([...newMessages, { text: "Sorry, I couldn't process your request.", sender: 'assistant' }]);
                }
            };

            const handleEnterPress = (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            };

            return (
                <div id="chat-container" className={darkMode ? 'dark-mode' : ''}>
                    <div className="header">
                        <span id="typing-effect"></span>
                    </div>
                    <div className="messages">
                        {messages.map((msg, index) => (
                            <div key={index} className={`message ${msg.sender}`}>
                                {msg.text}
                            </div>
                        ))}
                        <div ref={messagesEndRef} />
                    </div>
                    <div className="input-group">
                        <input
                            type="text"
                            id="user-input"
                            className="form-control"
                            placeholder="Type your message here..."
                            value={userInput}
                            onChange={(e) => setUserInput(e.target.value)}
                            onKeyPress={handleEnterPress}
                        />
                        <div className="input-group-append">
                            <button id="send-button" className="btn" onClick={sendMessage}>
                                Send
                            </button>
                        </div>
                    </div>
                    <div className="footer">
                        Developed by Naman<br />
                        <a href="https://www.linkedin.com/in/vinay-kumar-yadav-49571a28b/" 
                           target="_blank" 
                           style={{color: '#ff66cc'}}>
                            LinkedIn
                        </a>
                    </div>
                </div>
            );
        }

        // Typing effect for the header
        const text = "AI Chat Assistant";
        let i = 0;
        function typeWriter() {
            if (i < text.length) {
                document.getElementById("typing-effect").innerHTML += text.charAt(i);
                i++;
                setTimeout(typeWriter, 100);
            }
        }

        // Render React component and start typing effect
        const root = ReactDOM.createRoot(document.getElementById('chat-container'));
        root.render(<ChatApp />);
        typeWriter();
    </ script>
</body>
</html>
